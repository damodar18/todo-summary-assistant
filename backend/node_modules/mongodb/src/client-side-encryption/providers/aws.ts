import {
  type AWSCredentialProvider,
  AWSSDKCredentialProvider
} from '../../cmap/auth/aws_temporary_credentials';
import { type KMSProviders } from '.';

/**
 * @internal
 */
export async function loadAWSCredentials(
  kmsProviders: KMSProviders,
  provider?: AWSCredentialProvider
): Promise<KMSProviders> {
  const credentialProvider = new AWSSDKCredentialProvider(provider);




  const {
    SecretAccessKey = '',
    AccessKeyId = '',
    Token
  } = await credentialProvider.getCredentials();
  const aws: NonNullable<KMSProviders['aws']> = {
    secretAccessKey: SecretAccessKey,
    accessKeyId: AccessKeyId
  };


  Token != null && (aws.sessionToken = Token);

  return { ...kmsProviders, aws };
}
